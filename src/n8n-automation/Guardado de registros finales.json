{
  "name": "Guardado de registros finales",
  "nodes": [
    {
      "parameters": {
        "collection": "titles",
        "options": {}
      },
      "type": "n8n-nodes-base.mongoDb",
      "typeVersion": 1.2,
      "position": [
        -432,
        -240
      ],
      "id": "98a9d9cc-f90e-49a4-83dd-286750ebdc6f",
      "name": "Find documents",
      "credentials": {
        "mongoDb": {
          "id": "44uvjFS2nQmOBnWb",
          "name": "MongoDB account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "dcbb720e-e03d-432b-a73a-ad5b0787502c",
              "name": "_id",
              "value": "={{ $json._id }}",
              "type": "string"
            },
            {
              "id": "32aec684-61a4-4696-9bac-008481b96d27",
              "name": "text",
              "value": "={{ $json.title }}",
              "type": "string"
            },
            {
              "id": "af72be58-c30c-4649-92b6-5eaac36846bd",
              "name": "cluster",
              "value": "={{ $json.cluster }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        384,
        -384
      ],
      "id": "78db728d-51ae-4679-b9af-433431b2f2a0",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4dd790eb-4486-4553-a23c-f3f23f0f2a55",
              "leftValue": "={{ $json.cluster }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "lt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        560,
        -384
      ],
      "id": "61d15973-cef4-4adc-8e53-7d208bccaa68",
      "name": "If"
    },
    {
      "parameters": {
        "collection": "urls",
        "options": {},
        "query": "={\"title\": \"{{ $json.text }}\"} "
      },
      "type": "n8n-nodes-base.mongoDb",
      "typeVersion": 1.2,
      "position": [
        1040,
        -304
      ],
      "id": "c86efcda-f461-4feb-af29-30326f6a3f48",
      "name": "Find documents1",
      "credentials": {
        "mongoDb": {
          "id": "44uvjFS2nQmOBnWb",
          "name": "MongoDB account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ef8ab112-90d1-459e-b131-145127a8acaa",
              "name": "cluster",
              "value": "={{ $('Remove Duplicates').item.json.cluster }}",
              "type": "number"
            },
            {
              "id": "093d3b44-acd7-43ff-8087-7cb1727b5e3b",
              "name": "link",
              "value": "={{ $json.link }}",
              "type": "string"
            },
            {
              "id": "7a44f2f0-be87-406d-968c-7526b4ffc2b9",
              "name": "title",
              "value": "={{ $json.title }}",
              "type": "string"
            },
            {
              "id": "ca3d470f-b7b5-4e31-a26c-b2ed9b7417cb",
              "name": "category",
              "value": "={{ $json.category }}",
              "type": "string"
            },
            {
              "id": "94c93391-a831-4b2f-b6a3-34da9e525c5d",
              "name": "creation_date",
              "value": "={{ $json.creation_date }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1216,
        -304
      ],
      "id": "faf9b973-2438-4b7f-9e9a-69e678e5cd69",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "operation": "insert",
        "collection": "notice",
        "fields": "cluster,link,title,content,category,creation_date",
        "options": {}
      },
      "type": "n8n-nodes-base.mongoDb",
      "typeVersion": 1.2,
      "position": [
        3216,
        -320
      ],
      "id": "3bbb301d-3fec-4f08-aa6e-df85e3d7c3c4",
      "name": "Insert documents",
      "credentials": {
        "mongoDb": {
          "id": "44uvjFS2nQmOBnWb",
          "name": "MongoDB account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.link }}",
                    "rightValue": "exitosanoticias.pe",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    },
                    "id": "702ea433-c72a-4e48-804e-b8f703f14cfb"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "exitosa"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "6d23dae7-49a4-4766-ae75-fc39651a1bb3",
                    "leftValue": "={{ $json.link }}",
                    "rightValue": "panamericana.pe",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "panamericana"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "870ebcf7-3a78-4e81-8943-e89798332ba5",
                    "leftValue": "={{ $json.link }}",
                    "rightValue": "larepublica.pe",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "larepublica"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "a6a74d3f-2388-4356-8f99-a82379dc003d",
                    "leftValue": "={{ $json.link }}",
                    "rightValue": "rpp.pe",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "rpp"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "9a2e3dfe-690c-4a59-8fe0-757f423927a0",
                    "leftValue": "={{ $json.link }}",
                    "rightValue": "eltiempo.pe",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "eltiempo"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "cbe0942f-cbd3-4ce7-b9f3-c1abe8947ee1",
                    "leftValue": "={{ $json.link }}",
                    "rightValue": "diariocorreo.pe",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "diariocorreo"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "67f357a4-6b69-489b-93bf-14a55652ee63",
                    "leftValue": "={{ $json.link }}",
                    "rightValue": "peru21.pe",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "peru21"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "e00a373b-a5c9-4e81-8a58-a49eda81480f",
                    "leftValue": "={{ $json.link }}",
                    "rightValue": "elcomercio.pe",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "elcomercio"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1408,
        -400
      ],
      "id": "88e083a4-0b89-43a5-a80c-b4771aaa717f",
      "name": "Switch"
    },
    {
      "parameters": {
        "url": "={{ $json.link }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1888,
        -976
      ],
      "id": "afaf2157-1a0f-49e2-b6c3-706bbb962e9a",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "url": "={{ $json.link }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1888,
        -768
      ],
      "id": "07c23046-7d7d-4d8e-a4c0-475484e8571b",
      "name": "HTTP Request1"
    },
    {
      "parameters": {
        "url": "={{ $json.link }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1888,
        -576
      ],
      "id": "f789b7bc-2d20-4ca9-8fa7-3fe431327e74",
      "name": "HTTP Request2",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "url": "={{ $json.link }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1888,
        -384
      ],
      "id": "e589ef47-e180-45e5-9a95-3a30c1bae2a3",
      "name": "HTTP Request3",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "url": "={{ $json.link }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1888,
        -192
      ],
      "id": "0202a7f4-8857-41cb-8b3b-6f38853880c3",
      "name": "HTTP Request4"
    },
    {
      "parameters": {
        "url": "={{ $json.link }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1888,
        0
      ],
      "id": "06750719-03dc-40a8-be44-6ff70c5a28c2",
      "name": "HTTP Request5"
    },
    {
      "parameters": {
        "url": "={{ $json.link }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1888,
        192
      ],
      "id": "c130e278-6477-4c88-8667-d947d7ee7976",
      "name": "HTTP Request6"
    },
    {
      "parameters": {
        "url": "={{ $json.link }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1888,
        400
      ],
      "id": "e6dfd48d-7053-412f-a156-f884ad7cb996",
      "name": "HTTP Request7"
    },
    {
      "parameters": {
        "operation": "extractHtmlContent",
        "extractionValues": {
          "values": [
            {
              "key": "contenido",
              "cssSelector": ".content",
              "returnValue": "html"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.html",
      "typeVersion": 1.2,
      "position": [
        2096,
        -976
      ],
      "id": "f4f4ae5d-4ff1-49bb-a8a9-a8ff11af34b1",
      "name": "HTML"
    },
    {
      "parameters": {
        "operation": "extractHtmlContent",
        "extractionValues": {
          "values": [
            {
              "key": "contenido",
              "cssSelector": ".nota",
              "returnValue": "html"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.html",
      "typeVersion": 1.2,
      "position": [
        2096,
        -768
      ],
      "id": "778a8009-1b6f-4ac1-8cd9-d3f2556fa485",
      "name": "HTML1"
    },
    {
      "parameters": {
        "operation": "extractHtmlContent",
        "extractionValues": {
          "values": [
            {
              "key": "contenido",
              "cssSelector": ".MainContent_main__body__i6gEa",
              "returnValue": "html"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.html",
      "typeVersion": 1.2,
      "position": [
        2096,
        -576
      ],
      "id": "f19b9fbd-d315-4735-b074-02636e5d4fa5",
      "name": "HTML2"
    },
    {
      "parameters": {
        "operation": "extractHtmlContent",
        "extractionValues": {
          "values": [
            {
              "key": "contenido",
              "cssSelector": ".body",
              "returnValue": "html"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.html",
      "typeVersion": 1.2,
      "position": [
        2096,
        -384
      ],
      "id": "3ef48f15-6001-4a8d-ae41-ebea150d045f",
      "name": "HTML3",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "extractHtmlContent",
        "extractionValues": {
          "values": [
            {
              "key": "contenido",
              "cssSelector": ".et_pb_post_content",
              "returnValue": "html"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.html",
      "typeVersion": 1.2,
      "position": [
        2096,
        -192
      ],
      "id": "a9075881-877b-4606-8495-7f42cb999df3",
      "name": "HTML4"
    },
    {
      "parameters": {
        "operation": "extractHtmlContent",
        "extractionValues": {
          "values": [
            {
              "key": "contenido",
              "cssSelector": ".story-contents__content  ",
              "returnValue": "html"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.html",
      "typeVersion": 1.2,
      "position": [
        2096,
        0
      ],
      "id": "1dc6902c-8b5a-455f-bae4-e0076cb3dc22",
      "name": "HTML5"
    },
    {
      "parameters": {
        "operation": "extractHtmlContent",
        "extractionValues": {
          "values": [
            {
              "key": "contenido",
              "cssSelector": ".articulo-main-content-full",
              "returnValue": "html"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.html",
      "typeVersion": 1.2,
      "position": [
        2096,
        192
      ],
      "id": "47bf672c-eb78-436c-82e5-74359baf6211",
      "name": "HTML6"
    },
    {
      "parameters": {
        "operation": "extractHtmlContent",
        "extractionValues": {
          "values": [
            {
              "key": "contenido",
              "cssSelector": ".story-contents__content",
              "returnValue": "html"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.html",
      "typeVersion": 1.2,
      "position": [
        2096,
        400
      ],
      "id": "eade75ad-5232-4cc4-8157-93c21edf372e",
      "name": "HTML7"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e68fc2f8-3d2d-4a5a-9832-e77ab6c71930",
              "name": "cluster",
              "value": "={{ $('Edit Fields1').item.json.cluster }}",
              "type": "number"
            },
            {
              "id": "beaccc42-555c-4620-945c-9cf9aa325acd",
              "name": "link",
              "value": "={{ $('Edit Fields1').item.json.link }}",
              "type": "string"
            },
            {
              "id": "c21e8632-c55a-4bf1-9215-8bf7853208ba",
              "name": "title",
              "value": "={{ $('Edit Fields1').item.json.title }}",
              "type": "string"
            },
            {
              "id": "d8a962e6-425e-4b0b-9a62-ac7c12191f66",
              "name": "content",
              "value": "={{ $json.contenido_limpio }}",
              "type": "string"
            },
            {
              "id": "dbf26e91-8756-4ec5-a7fa-76cc49faccc0",
              "name": "category",
              "value": "={{ $('Edit Fields1').item.json.category }}",
              "type": "string"
            },
            {
              "id": "2b1956f1-1b0d-4565-a6ad-5a8d6eb8fcd7",
              "name": "creation_date",
              "value": "={{ $('Edit Fields1').item.json.creation_date }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2640,
        -976
      ],
      "id": "3a29483f-6693-4d2e-ae0e-3e25245ebd17",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5d98b49a-2f9e-477c-b5b1-a934e2c07202",
              "name": "cluster",
              "value": "={{ $('Edit Fields1').item.json.cluster }}",
              "type": "number"
            },
            {
              "id": "46ff0110-6381-492e-89e1-bedbd169ea55",
              "name": "link",
              "value": "={{ $('Edit Fields1').item.json.link }}",
              "type": "string"
            },
            {
              "id": "c9f7fd0d-084c-492d-b55f-86c652aa64b3",
              "name": "title",
              "value": "={{ $('Edit Fields1').item.json.title }}",
              "type": "string"
            },
            {
              "id": "9c34019b-08a1-4f0d-bebb-9df6ffec1f6e",
              "name": "content",
              "value": "={{ $json.contenido_limpio }}",
              "type": "string"
            },
            {
              "id": "53239d82-75d5-4727-9201-f7189f7f7aef",
              "name": "category",
              "value": "={{ $('Edit Fields1').item.json.category }}",
              "type": "string"
            },
            {
              "id": "a135773d-8026-42ae-87c7-30edb136480c",
              "name": "creation_date",
              "value": "={{ $('Edit Fields1').item.json.creation_date }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2640,
        -768
      ],
      "id": "fd33de41-f5c7-4d20-871c-7dd7d56e079c",
      "name": "Edit Fields3"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "71ba1ed8-dc5e-4b2c-a0d6-919392dcb019",
              "name": "cluster",
              "value": "={{ $('Edit Fields1').item.json.cluster }}",
              "type": "number"
            },
            {
              "id": "bb7d722f-f0a4-4dda-bb21-1d0ddced7b32",
              "name": "link",
              "value": "={{ $('Edit Fields1').item.json.link }}",
              "type": "string"
            },
            {
              "id": "7bd30d21-47db-42c0-b290-8ab3e42807db",
              "name": "title",
              "value": "={{ $('Edit Fields1').item.json.title }}",
              "type": "string"
            },
            {
              "id": "03f29bb9-7a08-447c-be33-cf9a444d8b7d",
              "name": "content",
              "value": "={{ $json.texto_limpio }}",
              "type": "string"
            },
            {
              "id": "d246e991-dc5f-48f8-9ef7-9bf96ea39880",
              "name": "category",
              "value": "={{ $('Edit Fields1').item.json.category }}",
              "type": "string"
            },
            {
              "id": "0e6458fe-ae0f-4f3e-858d-ed0b770b293c",
              "name": "creation_date",
              "value": "={{ $('Edit Fields1').item.json.creation_date }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2640,
        -576
      ],
      "id": "44617746-80f6-4269-a83f-6a477c288fa5",
      "name": "Edit Fields4"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9073b252-ca82-476a-ba80-c9db8c57cca5",
              "name": "cluster",
              "value": "={{ $('Edit Fields1').item.json.cluster }}",
              "type": "number"
            },
            {
              "id": "f4c65d61-27aa-4502-bf63-05a825c2d8d4",
              "name": "link",
              "value": "={{ $('Edit Fields1').item.json.link }}",
              "type": "string"
            },
            {
              "id": "9d630e23-5714-45eb-bae1-09dcaae1eb62",
              "name": "title",
              "value": "={{ $('Edit Fields1').item.json.title }}",
              "type": "string"
            },
            {
              "id": "d8026c61-c48e-4113-bc3b-d3bb4429a434",
              "name": "content",
              "value": "={{ $json.texto_limpio }}",
              "type": "string"
            },
            {
              "id": "bc1f78dc-0b98-436e-9512-eb96e8dca285",
              "name": "category",
              "value": "={{ $('Edit Fields1').item.json.category }}",
              "type": "string"
            },
            {
              "id": "ae46a1a5-53e7-4698-be3d-5713fd25f914",
              "name": "creation_date",
              "value": "={{ $('Edit Fields1').item.json.creation_date }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2640,
        -384
      ],
      "id": "c909c57f-5a16-43b0-a7e7-89cad8addb78",
      "name": "Edit Fields5"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c33ecaa9-647f-420b-8864-058fa4bb6879",
              "name": "cluster",
              "value": "={{ $('Edit Fields1').item.json.cluster }}",
              "type": "number"
            },
            {
              "id": "442da4ae-5ba2-4488-abb1-90b3ee9c5200",
              "name": "link",
              "value": "={{ $('Edit Fields1').item.json.link }}",
              "type": "string"
            },
            {
              "id": "2251a9ed-6c3f-441d-bdfe-0e462b0cdcb4",
              "name": "title",
              "value": "={{ $('Edit Fields1').item.json.title }}",
              "type": "string"
            },
            {
              "id": "043d7af7-0e94-4126-82be-df8acf99ebde",
              "name": "content",
              "value": "={{ $json.texto_limpio }}",
              "type": "string"
            },
            {
              "id": "338da168-bbad-4ea2-b239-553b0c360062",
              "name": "category",
              "value": "={{ $('Edit Fields1').item.json.category }}",
              "type": "string"
            },
            {
              "id": "83ae20a5-d833-4597-8a39-7a33b370509d",
              "name": "creation_date",
              "value": "={{ $('Edit Fields1').item.json.creation_date }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2640,
        -192
      ],
      "id": "999c2e04-4137-4b09-b9ca-a4220543dbd9",
      "name": "Edit Fields6"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c1f02728-9806-4069-aeaf-37cfaa4026f0",
              "name": "cluster",
              "value": "={{ $('Edit Fields1').item.json.cluster }}",
              "type": "number"
            },
            {
              "id": "fe2f6727-42b3-4ce9-8527-0eb1f69d7af7",
              "name": "link",
              "value": "={{ $('Edit Fields1').item.json.link }}",
              "type": "string"
            },
            {
              "id": "a11fc34d-b3cb-4377-b658-30901c0e0f08",
              "name": "title",
              "value": "={{ $('Edit Fields1').item.json.title }}",
              "type": "string"
            },
            {
              "id": "ec70f378-908c-4db8-84da-0efc1c5c0e3f",
              "name": "content",
              "value": "={{ $json.contenido_limpio }}",
              "type": "string"
            },
            {
              "id": "70552219-9851-4c77-9db9-c7886f2be227",
              "name": "category",
              "value": "={{ $('Edit Fields1').item.json.category }}",
              "type": "string"
            },
            {
              "id": "b200ba8f-5cae-4d78-b88e-84403f640f7a",
              "name": "creation_date",
              "value": "={{ $('Edit Fields1').item.json.creation_date }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2656,
        0
      ],
      "id": "5bfe1ce0-b350-48cd-a27d-ee3c3201f0f5",
      "name": "Edit Fields7"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "076f3f39-2fbf-4f45-ae6e-a18d6f11780a",
              "name": "cluster",
              "value": "={{ $('Edit Fields1').item.json.cluster }}",
              "type": "number"
            },
            {
              "id": "8426795b-2cf8-4967-b36f-5142a5d6ce32",
              "name": "link",
              "value": "={{ $('Edit Fields1').item.json.link }}",
              "type": "string"
            },
            {
              "id": "8dd25209-d129-4bfe-a449-6b41bd859721",
              "name": "title",
              "value": "={{ $('Edit Fields1').item.json.title }}",
              "type": "string"
            },
            {
              "id": "593bd68a-6776-4501-a5f8-2320da46451c",
              "name": "content",
              "value": "={{ $json.texto_limpio }}",
              "type": "string"
            },
            {
              "id": "e718a6d4-22b1-4f04-8b09-168c26f2871f",
              "name": "category",
              "value": "={{ $('Edit Fields1').item.json.category }}",
              "type": "string"
            },
            {
              "id": "25aacaf6-57df-410d-a3ae-a6295b89e3c1",
              "name": "creation_date",
              "value": "={{ $('Edit Fields1').item.json.creation_date }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2656,
        192
      ],
      "id": "62fc687d-99c2-48f6-a9de-0a26288e6405",
      "name": "Edit Fields8"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "dfd300ec-5dea-4042-bfd8-0442a7334679",
              "name": "cluster",
              "value": "={{ $('Edit Fields1').item.json.cluster }}",
              "type": "number"
            },
            {
              "id": "b27da84e-ee48-4016-9561-b44b8a350473",
              "name": "link",
              "value": "={{ $('Edit Fields1').item.json.link }}",
              "type": "string"
            },
            {
              "id": "4bd7b477-9916-46e6-bab3-f85d779cbbf8",
              "name": "title",
              "value": "={{ $('Edit Fields1').item.json.title }}",
              "type": "string"
            },
            {
              "id": "7635ea88-f5b9-4965-b776-a50b47827b6c",
              "name": "content",
              "value": "={{ $json.texto_limpio }}",
              "type": "string"
            },
            {
              "id": "6305fd0f-f4af-463d-9c5e-28e7b4d901ea",
              "name": "category",
              "value": "={{ $('Edit Fields1').item.json.category }}",
              "type": "string"
            },
            {
              "id": "c55c4f65-a744-401f-8c33-8bd5c0ecdc16",
              "name": "creation_date",
              "value": "={{ $('Edit Fields1').item.json.creation_date }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2656,
        400
      ],
      "id": "efb27dad-d1b6-4616-aea3-65f4f8605e09",
      "name": "Edit Fields9"
    },
    {
      "parameters": {
        "numberInputs": 8
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        3008,
        -416
      ],
      "id": "41525553-8640-4db4-a0e4-41de9a47f4c5",
      "name": "Merge"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.removeDuplicates",
      "typeVersion": 2,
      "position": [
        848,
        -304
      ],
      "id": "9f18fe4a-8cff-4985-a460-302d60cdd8ec",
      "name": "Remove Duplicates"
    },
    {
      "parameters": {
        "jsCode": "// Función para limpiar texto HTML y codificación rota\nfunction cleanText(html) {\n  if (!html) return \"\";\n\n  let text = html;\n\n  // 1️⃣ Eliminar etiquetas HTML, scripts y estilos\n  text = text.replace(/<script[\\s\\S]*?>[\\s\\S]*?<\\/script>/gi, \"\");\n  text = text.replace(/<style[\\s\\S]*?>[\\s\\S]*?<\\/style>/gi, \"\");\n  text = text.replace(/<[^>]+>/g, \" \");\n\n  // 2️⃣ Decodificar entidades HTML comunes y numéricas\n  text = text.replace(/&#(\\d+);/g, (_, code) => String.fromCharCode(code));\n  text = text.replace(/&([a-zA-Z]+);/g, (match, entity) => {\n    const map = {\n      amp: \"&\", lt: \"<\", gt: \">\", quot: '\"', apos: \"'\",\n      aacute: \"á\", eacute: \"é\", iacute: \"í\", oacute: \"ó\", uacute: \"ú\",\n      Aacute: \"Á\", Eacute: \"É\", Iacute: \"Í\", Oacute: \"Ó\", Uacute: \"Ú\",\n      ntilde: \"ñ\", Ntilde: \"Ñ\", nbsp: \" \"\n    };\n    return map[entity] || match;\n  });\n\n  // 3️⃣ Reemplazar caracteres dañados comunes\n  const fixMap = {\n    \"Ã¡\": \"á\", \"Ã©\": \"é\", \"Ã­\": \"í\", \"Ã³\": \"ó\", \"Ãº\": \"ú\",\n    \"Ã\": \"Á\", \"Ã‰\": \"É\", \"Ã\": \"Í\", \"Ã“\": \"Ó\", \"Ãš\": \"Ú\",\n    \"Ã±\": \"ñ\", \"Ã‘\": \"Ñ\", \"Â\": \"\", \"�\": \"\"\n  };\n  for (const [wrong, right] of Object.entries(fixMap)) {\n    text = text.replace(new RegExp(wrong, \"g\"), right);\n  }\n\n  // 4️⃣ Eliminar URLs, emojis, símbolos raros y múltiples espacios\n  text = text.replace(/https?:\\/\\/\\S+/g, \" \");\n  text = text.replace(/[^\\p{L}\\p{N}\\p{P}\\p{Z}]/gu, \" \"); // elimina emojis y símbolos\n  text = text.replace(/\\s+/g, \" \").trim();\n\n  return text;\n}\n\n// Procesar todos los items del flujo\nfor (const item of $input.all()) {\n  const contenido = item.json.contenido || \"\";\n  item.json.contenido_limpio = cleanText(contenido);\n}\n\nreturn $input.all();"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2368,
        -976
      ],
      "id": "51fe22d2-3208-4e41-b347-06339c4bfe4d",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "jsCode": "function cleanText(html) {\n  if (!html) return \"\";\n\n  let text = html;\n\n  // 1️⃣ Quitar saltos, tabulaciones y comillas escapadas\n  text = text.replace(/\\\\n|\\\\t|\\\\r/g, \" \");\n  text = text.replace(/\\\\\"/g, '\"').replace(/\\\\'/g, \"'\");\n  \n  // 2️⃣ Eliminar secciones de script, style, JSON, etc.\n  text = text.replace(/<script[\\s\\S]*?<\\/script>/gi, \"\");\n  text = text.replace(/<style[\\s\\S]*?<\\/style>/gi, \"\");\n  text = text.replace(/var\\s+\\w+\\s*=\\s*\\[[\\s\\S]*?\\];?/gi, \"\"); // arrays JS como el de \"items\"\n  text = text.replace(/ga\\([\\s\\S]*?\\);/gi, \"\");\n  text = text.replace(/console\\.log\\([\\s\\S]*?\\);/gi, \"\");\n  \n  // 3️⃣ Eliminar todas las etiquetas HTML\n  text = text.replace(/<[^>]+>/g, \" \");\n\n  // 4️⃣ Decodificar entidades HTML comunes\n  text = text.replace(/&#(\\d+);/g, (_, code) => String.fromCharCode(code));\n  text = text.replace(/&([a-zA-Z]+);/g, (match, entity) => {\n    const map = {\n      amp: \"&\", lt: \"<\", gt: \">\", quot: '\"', apos: \"'\",\n      aacute: \"á\", eacute: \"é\", iacute: \"í\", oacute: \"ó\", uacute: \"ú\",\n      Aacute: \"Á\", Eacute: \"É\", Iacute: \"Í\", Oacute: \"Ó\", Uacute: \"Ú\",\n      ntilde: \"ñ\", Ntilde: \"Ñ\", nbsp: \" \"\n    };\n    return map[entity] || match;\n  });\n\n  // 5️⃣ Corregir caracteres mal codificados\n  const fixMap = {\n    \"Ã¡\": \"á\", \"Ã©\": \"é\", \"Ã­\": \"í\", \"Ã³\": \"ó\", \"Ãº\": \"ú\",\n    \"Ã\": \"Á\", \"Ã‰\": \"É\", \"Ã\": \"Í\", \"Ã“\": \"Ó\", \"Ãš\": \"Ú\",\n    \"Ã±\": \"ñ\", \"Ã‘\": \"Ñ\", \"Â\": \"\", \"�\": \"\"\n  };\n  for (const [wrong, right] of Object.entries(fixMap)) {\n    text = text.replace(new RegExp(wrong, \"g\"), right);\n  }\n\n  // 6️⃣ Eliminar URLs, emojis, símbolos no imprimibles\n  text = text.replace(/https?:\\/\\/\\S+/g, \" \");\n  text = text.replace(/[^\\p{L}\\p{N}\\p{P}\\p{Z}]/gu, \" \");\n  \n  // 7️⃣ Normalizar espacios y signos de puntuación\n  text = text.replace(/\\s+/g, \" \").replace(/\\s*([.,!?;:])\\s*/g, \"$1 \").trim();\n\n  return text;\n}\n\n// Procesar todos los items del flujo\nfor (const item of $input.all()) {\n  const contenido = item.json.contenido || \"\";\n  item.json.contenido_limpio = cleanText(contenido);\n}\n\nreturn $input.all();"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2368,
        -768
      ],
      "id": "5455f8ff-790b-41c0-9cc4-d2702850ad9f",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "jsCode": "function cleanText(html) {\n  if (!html) return \"\";\n\n  let text = html;\n\n  // 1️⃣ Normalizar codificación y eliminar escapes\n  text = text.replace(/\\\\[ntr]/g, \" \");\n  text = text.replace(/\\\\\"/g, '\"').replace(/\\\\'/g, \"'\");\n  text = text.replace(/&nbsp;|&#160;/g, \" \");\n\n  // 2️⃣ Eliminar bloques JS y CSS (muy agresivo)\n  text = text\n    .replace(/<script[\\s\\S]*?<\\/script>/gi, \" \")\n    .replace(/<style[\\s\\S]*?<\\/style>/gi, \" \")\n    .replace(/window\\.addEventListener[\\s\\S]*?(?=<|$)/gi, \" \")\n    .replace(/googletag\\.[\\s\\S]*?(?=<|$)/gi, \" \")\n    .replace(/gptadslots\\[[\\s\\S]*?\\];/gi, \" \")\n    .replace(/sizeMapping\\([\\s\\S]*?\\)\\.build\\(\\);/gi, \" \")\n    .replace(/screen\\s+and\\s+\\(.*?\\)\\s*\\{/gi, \" \")\n    .replace(/\\.[a-zA-Z0-9_-]+\\s*\\{[\\s\\S]*?\\}/g, \" \")\n    .replace(/var\\s+\\w+\\s*=\\s*[\\s\\S]*?;/g, \" \");\n\n  // 3️⃣ Eliminar etiquetas HTML\n  text = text.replace(/<[^>]+>/g, \" \");\n\n  // 4️⃣ Quitar URLs, nombres de clases, CSS inline y residuos\n  text = text\n    .replace(/https?:\\/\\/\\S+/g, \" \")\n    .replace(/[{}();<>[\\]]/g, \" \")\n    .replace(/\\b(addService|defineSlot|display|cmd|push|function|return|if|else|window|document)\\b/gi, \" \")\n    .replace(/\\b(slotvideoad|slotinline|slotVideoinread2|mappinginline|mappingvideoad|slotvideoinread)\\b/gi, \" \");\n\n  // 5️⃣ Eliminar texto duplicado o con patrones técnicos\n  text = text.replace(/TE RECOMENDAMOS[\\s\\S]*$/i, \" \");\n  text = text.replace(/PUEDES VER[\\s\\S]*$/i, \" \");\n\n  // 6️⃣ Decodificar entidades HTML\n  text = text.replace(/&#(\\d+);/g, (_, code) => String.fromCharCode(code));\n  const map = {\n    amp: \"&\", lt: \"<\", gt: \">\", quot: '\"', apos: \"'\", aacute: \"á\",\n    eacute: \"é\", iacute: \"í\", oacute: \"ó\", uacute: \"ú\", ntilde: \"ñ\",\n    Aacute: \"Á\", Eacute: \"É\", Iacute: \"Í\", Oacute: \"Ó\", Uacute: \"Ú\",\n    Ntilde: \"Ñ\"\n  };\n  text = text.replace(/&([a-zA-Z]+);/g, (m, e) => map[e] || m);\n\n  // 7️⃣ Corregir malcodificaciones comunes\n  const fixMap = {\n    \"Ã¡\": \"á\", \"Ã©\": \"é\", \"Ã­\": \"í\", \"Ã³\": \"ó\", \"Ãº\": \"ú\",\n    \"Ã\": \"Á\", \"Ã‰\": \"É\", \"Ã\": \"Í\", \"Ã“\": \"Ó\", \"Ãš\": \"Ú\",\n    \"Ã±\": \"ñ\", \"Ã‘\": \"Ñ\", \"Â\": \"\", \"�\": \"\"\n  };\n  for (const [wrong, right] of Object.entries(fixMap)) {\n    text = text.replace(new RegExp(wrong, \"g\"), right);\n  }\n\n  // 8️⃣ Quitar números y símbolos extraños\n  text = text.replace(/\\d{2,4}\\s*(px|em|%|vh|vw)?/gi, \" \");\n  text = text.replace(/[^\\p{L}\\p{N}\\p{P}\\p{Z}]/gu, \" \");\n\n  // 9️⃣ Compactar espacios y limpiar signos\n  text = text.replace(/\\s+/g, \" \").replace(/\\s*([.,!?;:])\\s*/g, \"$1 \").trim();\n\n  return text;\n}\n\n// Aplicar limpieza a todos los items\nfor (const item of $input.all()) {\n  const contenido = item.json.contenido || \"\";\n  const titulo = item.json.titulo || \"\";\n  item.json.texto_limpio = cleanText(titulo + \". \" + contenido);\n}\n\nreturn $input.all();\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2368,
        -576
      ],
      "id": "82678aa2-c25c-4d7f-a1bd-3deeb2e04166",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "jsCode": "function cleanText(html) {\n  if (!html) return \"\";\n\n  let text = html;\n\n  // 1️⃣ Normalizar codificación y eliminar escapes\n  text = text.replace(/\\\\[ntr]/g, \" \");\n  text = text.replace(/\\\\\"/g, '\"').replace(/\\\\'/g, \"'\");\n  text = text.replace(/&nbsp;|&#160;/g, \" \");\n\n  // 2️⃣ Eliminar bloques JS y CSS (muy agresivo)\n  text = text\n    .replace(/<script[\\s\\S]*?<\\/script>/gi, \" \")\n    .replace(/<style[\\s\\S]*?<\\/style>/gi, \" \")\n    .replace(/window\\.addEventListener[\\s\\S]*?(?=<|$)/gi, \" \")\n    .replace(/googletag\\.[\\s\\S]*?(?=<|$)/gi, \" \")\n    .replace(/gptadslots\\[[\\s\\S]*?\\];/gi, \" \")\n    .replace(/sizeMapping\\([\\s\\S]*?\\)\\.build\\(\\);/gi, \" \")\n    .replace(/screen\\s+and\\s+\\(.*?\\)\\s*\\{/gi, \" \")\n    .replace(/\\.[a-zA-Z0-9_-]+\\s*\\{[\\s\\S]*?\\}/g, \" \")\n    .replace(/var\\s+\\w+\\s*=\\s*[\\s\\S]*?;/g, \" \");\n\n  // 3️⃣ Eliminar etiquetas HTML\n  text = text.replace(/<[^>]+>/g, \" \");\n\n  // 4️⃣ Quitar URLs, nombres de clases, CSS inline y residuos\n  text = text\n    .replace(/https?:\\/\\/\\S+/g, \" \")\n    .replace(/[{}();<>[\\]]/g, \" \")\n    .replace(/\\b(addService|defineSlot|display|cmd|push|function|return|if|else|window|document)\\b/gi, \" \")\n    .replace(/\\b(slotvideoad|slotinline|slotVideoinread2|mappinginline|mappingvideoad|slotvideoinread)\\b/gi, \" \");\n\n  // 5️⃣ Eliminar texto duplicado o con patrones técnicos\n  text = text.replace(/TE RECOMENDAMOS[\\s\\S]*$/i, \" \");\n  text = text.replace(/PUEDES VER[\\s\\S]*$/i, \" \");\n\n  // 6️⃣ Decodificar entidades HTML\n  text = text.replace(/&#(\\d+);/g, (_, code) => String.fromCharCode(code));\n  const map = {\n    amp: \"&\", lt: \"<\", gt: \">\", quot: '\"', apos: \"'\", aacute: \"á\",\n    eacute: \"é\", iacute: \"í\", oacute: \"ó\", uacute: \"ú\", ntilde: \"ñ\",\n    Aacute: \"Á\", Eacute: \"É\", Iacute: \"Í\", Oacute: \"Ó\", Uacute: \"Ú\",\n    Ntilde: \"Ñ\"\n  };\n  text = text.replace(/&([a-zA-Z]+);/g, (m, e) => map[e] || m);\n\n  // 7️⃣ Corregir malcodificaciones comunes\n  const fixMap = {\n    \"Ã¡\": \"á\", \"Ã©\": \"é\", \"Ã­\": \"í\", \"Ã³\": \"ó\", \"Ãº\": \"ú\",\n    \"Ã\": \"Á\", \"Ã‰\": \"É\", \"Ã\": \"Í\", \"Ã“\": \"Ó\", \"Ãš\": \"Ú\",\n    \"Ã±\": \"ñ\", \"Ã‘\": \"Ñ\", \"Â\": \"\", \"�\": \"\"\n  };\n  for (const [wrong, right] of Object.entries(fixMap)) {\n    text = text.replace(new RegExp(wrong, \"g\"), right);\n  }\n\n  // 8️⃣ Quitar números y símbolos extraños\n  text = text.replace(/\\d{2,4}\\s*(px|em|%|vh|vw)?/gi, \" \");\n  text = text.replace(/[^\\p{L}\\p{N}\\p{P}\\p{Z}]/gu, \" \");\n\n  // 9️⃣ Compactar espacios y limpiar signos\n  text = text.replace(/\\s+/g, \" \").replace(/\\s*([.,!?;:])\\s*/g, \"$1 \").trim();\n\n  return text;\n}\n\n// Aplicar limpieza a todos los items\nfor (const item of $input.all()) {\n  const contenido = item.json.contenido || \"\";\n  const titulo = item.json.titulo || \"\";\n  item.json.texto_limpio = cleanText(titulo + \". \" + contenido);\n}\n\nreturn $input.all();\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2368,
        -384
      ],
      "id": "508b761e-f379-4152-86c7-f2831cc4fbda",
      "name": "Code in JavaScript3"
    },
    {
      "parameters": {
        "jsCode": "function cleanText(html) {\n  if (!html) return \"\";\n\n  let text = html;\n\n  // 1️⃣ Normalizar codificación y eliminar escapes\n  text = text.replace(/\\\\[ntr]/g, \" \");\n  text = text.replace(/\\\\\"/g, '\"').replace(/\\\\'/g, \"'\");\n  text = text.replace(/&nbsp;|&#160;/g, \" \");\n\n  // 2️⃣ Eliminar bloques JS y CSS (muy agresivo)\n  text = text\n    .replace(/<script[\\s\\S]*?<\\/script>/gi, \" \")\n    .replace(/<style[\\s\\S]*?<\\/style>/gi, \" \")\n    .replace(/window\\.addEventListener[\\s\\S]*?(?=<|$)/gi, \" \")\n    .replace(/googletag\\.[\\s\\S]*?(?=<|$)/gi, \" \")\n    .replace(/gptadslots\\[[\\s\\S]*?\\];/gi, \" \")\n    .replace(/sizeMapping\\([\\s\\S]*?\\)\\.build\\(\\);/gi, \" \")\n    .replace(/screen\\s+and\\s+\\(.*?\\)\\s*\\{/gi, \" \")\n    .replace(/\\.[a-zA-Z0-9_-]+\\s*\\{[\\s\\S]*?\\}/g, \" \")\n    .replace(/var\\s+\\w+\\s*=\\s*[\\s\\S]*?;/g, \" \");\n\n  // 3️⃣ Eliminar etiquetas HTML\n  text = text.replace(/<[^>]+>/g, \" \");\n\n  // 4️⃣ Quitar URLs, nombres de clases, CSS inline y residuos\n  text = text\n    .replace(/https?:\\/\\/\\S+/g, \" \")\n    .replace(/[{}();<>[\\]]/g, \" \")\n    .replace(/\\b(addService|defineSlot|display|cmd|push|function|return|if|else|window|document)\\b/gi, \" \")\n    .replace(/\\b(slotvideoad|slotinline|slotVideoinread2|mappinginline|mappingvideoad|slotvideoinread)\\b/gi, \" \");\n\n  // 5️⃣ Eliminar texto duplicado o con patrones técnicos\n  text = text.replace(/TE RECOMENDAMOS[\\s\\S]*$/i, \" \");\n  text = text.replace(/PUEDES VER[\\s\\S]*$/i, \" \");\n\n  // 6️⃣ Decodificar entidades HTML\n  text = text.replace(/&#(\\d+);/g, (_, code) => String.fromCharCode(code));\n  const map = {\n    amp: \"&\", lt: \"<\", gt: \">\", quot: '\"', apos: \"'\", aacute: \"á\",\n    eacute: \"é\", iacute: \"í\", oacute: \"ó\", uacute: \"ú\", ntilde: \"ñ\",\n    Aacute: \"Á\", Eacute: \"É\", Iacute: \"Í\", Oacute: \"Ó\", Uacute: \"Ú\",\n    Ntilde: \"Ñ\"\n  };\n  text = text.replace(/&([a-zA-Z]+);/g, (m, e) => map[e] || m);\n\n  // 7️⃣ Corregir malcodificaciones comunes\n  const fixMap = {\n    \"Ã¡\": \"á\", \"Ã©\": \"é\", \"Ã­\": \"í\", \"Ã³\": \"ó\", \"Ãº\": \"ú\",\n    \"Ã\": \"Á\", \"Ã‰\": \"É\", \"Ã\": \"Í\", \"Ã“\": \"Ó\", \"Ãš\": \"Ú\",\n    \"Ã±\": \"ñ\", \"Ã‘\": \"Ñ\", \"Â\": \"\", \"�\": \"\"\n  };\n  for (const [wrong, right] of Object.entries(fixMap)) {\n    text = text.replace(new RegExp(wrong, \"g\"), right);\n  }\n\n  // 8️⃣ Quitar números y símbolos extraños\n  text = text.replace(/\\d{2,4}\\s*(px|em|%|vh|vw)?/gi, \" \");\n  text = text.replace(/[^\\p{L}\\p{N}\\p{P}\\p{Z}]/gu, \" \");\n\n  // 9️⃣ Compactar espacios y limpiar signos\n  text = text.replace(/\\s+/g, \" \").replace(/\\s*([.,!?;:])\\s*/g, \"$1 \").trim();\n\n  return text;\n}\n\n// Aplicar limpieza a todos los items\nfor (const item of $input.all()) {\n  const contenido = item.json.contenido || \"\";\n  const titulo = item.json.titulo || \"\";\n  item.json.texto_limpio = cleanText(titulo + \". \" + contenido);\n}\n\nreturn $input.all();\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2368,
        -192
      ],
      "id": "a0b42794-fba0-42c0-ba1e-10b20417b37a",
      "name": "Code in JavaScript4"
    },
    {
      "parameters": {
        "jsCode": "// Recorremos todos los items de entrada\nfor (const item of $input.all()) {\n  let texto = item.json.contenido || \"\";\n\n  // 1️⃣ Eliminar todas las etiquetas HTML\n  texto = texto.replace(/<[^>]+>/g, \" \");\n\n  // 2️⃣ Decodificar entidades HTML comunes\n  const entidades = {\n    \"&aacute;\": \"á\", \"&eacute;\": \"é\", \"&iacute;\": \"í\",\n    \"&oacute;\": \"ó\", \"&uacute;\": \"ú\", \"&ntilde;\": \"ñ\",\n    \"&Aacute;\": \"Á\", \"&Eacute;\": \"É\", \"&Iacute;\": \"Í\",\n    \"&Oacute;\": \"Ó\", \"&Uacute;\": \"Ú\", \"&Ntilde;\": \"Ñ\",\n    \"&quot;\": \"\\\"\", \"&amp;\": \"&\", \"&lt;\": \"<\", \"&gt;\": \">\",\n    \"&nbsp;\": \" \"\n  };\n\n  texto = texto.replace(/&[a-zA-Z]+;/g, match => entidades[match] || match);\n\n  // 3️⃣ Quitar URLs, hashtags, menciones, scripts o códigos embebidos\n  texto = texto.replace(/https?:\\/\\/\\S+/g, \"\"); // URLs\n  texto = texto.replace(/@\\w+/g, \"\");           // menciones\n  texto = texto.replace(/#\\w+/g, \"\");           // hashtags\n  texto = texto.replace(/<script[\\s\\S]*?>[\\s\\S]*?<\\/script>/gi, \"\"); // scripts\n\n  // 4️⃣ Corregir codificaciones dañadas comunes (casos típicos de latin1 → utf8)\n  texto = texto\n    .replace(/�/g, \"ñ\") // Comisi�n → Comisión (aproximación)\n    .replace(/\\s+/g, \" \") // Espacios extra\n    .trim();\n\n  // Guardamos el texto limpio en un nuevo campo\n  item.json.contenido_limpio = texto;\n}\n\nreturn $input.all();"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2368,
        0
      ],
      "id": "adf951ea-093e-41f6-8d6a-aff542015e1d",
      "name": "Code in JavaScript5"
    },
    {
      "parameters": {
        "jsCode": "function cleanText(html) {\n  if (!html) return \"\";\n\n  let text = html;\n\n  // 1️⃣ Normalizar codificación y eliminar escapes\n  text = text.replace(/\\\\[ntr]/g, \" \");\n  text = text.replace(/\\\\\"/g, '\"').replace(/\\\\'/g, \"'\");\n  text = text.replace(/&nbsp;|&#160;/g, \" \");\n\n  // 2️⃣ Eliminar bloques JS y CSS (muy agresivo)\n  text = text\n    .replace(/<script[\\s\\S]*?<\\/script>/gi, \" \")\n    .replace(/<style[\\s\\S]*?<\\/style>/gi, \" \")\n    .replace(/window\\.addEventListener[\\s\\S]*?(?=<|$)/gi, \" \")\n    .replace(/googletag\\.[\\s\\S]*?(?=<|$)/gi, \" \")\n    .replace(/gptadslots\\[[\\s\\S]*?\\];/gi, \" \")\n    .replace(/sizeMapping\\([\\s\\S]*?\\)\\.build\\(\\);/gi, \" \")\n    .replace(/screen\\s+and\\s+\\(.*?\\)\\s*\\{/gi, \" \")\n    .replace(/\\.[a-zA-Z0-9_-]+\\s*\\{[\\s\\S]*?\\}/g, \" \")\n    .replace(/var\\s+\\w+\\s*=\\s*[\\s\\S]*?;/g, \" \");\n\n  // 3️⃣ Eliminar etiquetas HTML\n  text = text.replace(/<[^>]+>/g, \" \");\n\n  // 4️⃣ Quitar URLs, nombres de clases, CSS inline y residuos\n  text = text\n    .replace(/https?:\\/\\/\\S+/g, \" \")\n    .replace(/[{}();<>[\\]]/g, \" \")\n    .replace(/\\b(addService|defineSlot|display|cmd|push|function|return|if|else|window|document)\\b/gi, \" \")\n    .replace(/\\b(slotvideoad|slotinline|slotVideoinread2|mappinginline|mappingvideoad|slotvideoinread)\\b/gi, \" \");\n\n  // 5️⃣ Eliminar texto duplicado o con patrones técnicos\n  text = text.replace(/TE RECOMENDAMOS[\\s\\S]*$/i, \" \");\n  text = text.replace(/PUEDES VER[\\s\\S]*$/i, \" \");\n\n  // 6️⃣ Decodificar entidades HTML\n  text = text.replace(/&#(\\d+);/g, (_, code) => String.fromCharCode(code));\n  const map = {\n    amp: \"&\", lt: \"<\", gt: \">\", quot: '\"', apos: \"'\", aacute: \"á\",\n    eacute: \"é\", iacute: \"í\", oacute: \"ó\", uacute: \"ú\", ntilde: \"ñ\",\n    Aacute: \"Á\", Eacute: \"É\", Iacute: \"Í\", Oacute: \"Ó\", Uacute: \"Ú\",\n    Ntilde: \"Ñ\"\n  };\n  text = text.replace(/&([a-zA-Z]+);/g, (m, e) => map[e] || m);\n\n  // 7️⃣ Corregir malcodificaciones comunes\n  const fixMap = {\n    \"Ã¡\": \"á\", \"Ã©\": \"é\", \"Ã­\": \"í\", \"Ã³\": \"ó\", \"Ãº\": \"ú\",\n    \"Ã\": \"Á\", \"Ã‰\": \"É\", \"Ã\": \"Í\", \"Ã“\": \"Ó\", \"Ãš\": \"Ú\",\n    \"Ã±\": \"ñ\", \"Ã‘\": \"Ñ\", \"Â\": \"\", \"�\": \"\"\n  };\n  for (const [wrong, right] of Object.entries(fixMap)) {\n    text = text.replace(new RegExp(wrong, \"g\"), right);\n  }\n\n  // 8️⃣ Quitar números y símbolos extraños\n  text = text.replace(/\\d{2,4}\\s*(px|em|%|vh|vw)?/gi, \" \");\n  text = text.replace(/[^\\p{L}\\p{N}\\p{P}\\p{Z}]/gu, \" \");\n\n  // 9️⃣ Compactar espacios y limpiar signos\n  text = text.replace(/\\s+/g, \" \").replace(/\\s*([.,!?;:])\\s*/g, \"$1 \").trim();\n\n  return text;\n}\n\n// Aplicar limpieza a todos los items\nfor (const item of $input.all()) {\n  const contenido = item.json.contenido || \"\";\n  const titulo = item.json.titulo || \"\";\n  item.json.texto_limpio = cleanText(titulo + \". \" + contenido);\n}\n\nreturn $input.all();\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2368,
        192
      ],
      "id": "426dfcc6-1a4f-4090-9232-8f599054948d",
      "name": "Code in JavaScript6"
    },
    {
      "parameters": {
        "jsCode": "function cleanText(html) {\n  if (!html) return \"\";\n\n  let text = html;\n\n  // 1️⃣ Normalizar codificación y eliminar escapes\n  text = text.replace(/\\\\[ntr]/g, \" \");\n  text = text.replace(/\\\\\"/g, '\"').replace(/\\\\'/g, \"'\");\n  text = text.replace(/&nbsp;|&#160;/g, \" \");\n\n  // 2️⃣ Eliminar bloques JS y CSS (muy agresivo)\n  text = text\n    .replace(/<script[\\s\\S]*?<\\/script>/gi, \" \")\n    .replace(/<style[\\s\\S]*?<\\/style>/gi, \" \")\n    .replace(/window\\.addEventListener[\\s\\S]*?(?=<|$)/gi, \" \")\n    .replace(/googletag\\.[\\s\\S]*?(?=<|$)/gi, \" \")\n    .replace(/gptadslots\\[[\\s\\S]*?\\];/gi, \" \")\n    .replace(/sizeMapping\\([\\s\\S]*?\\)\\.build\\(\\);/gi, \" \")\n    .replace(/screen\\s+and\\s+\\(.*?\\)\\s*\\{/gi, \" \")\n    .replace(/\\.[a-zA-Z0-9_-]+\\s*\\{[\\s\\S]*?\\}/g, \" \")\n    .replace(/var\\s+\\w+\\s*=\\s*[\\s\\S]*?;/g, \" \");\n\n  // 3️⃣ Eliminar etiquetas HTML\n  text = text.replace(/<[^>]+>/g, \" \");\n\n  // 4️⃣ Quitar URLs, nombres de clases, CSS inline y residuos\n  text = text\n    .replace(/https?:\\/\\/\\S+/g, \" \")\n    .replace(/[{}();<>[\\]]/g, \" \")\n    .replace(/\\b(addService|defineSlot|display|cmd|push|function|return|if|else|window|document)\\b/gi, \" \")\n    .replace(/\\b(slotvideoad|slotinline|slotVideoinread2|mappinginline|mappingvideoad|slotvideoinread)\\b/gi, \" \");\n\n  // 5️⃣ Eliminar texto duplicado o con patrones técnicos\n  text = text.replace(/TE RECOMENDAMOS[\\s\\S]*$/i, \" \");\n  text = text.replace(/PUEDES VER[\\s\\S]*$/i, \" \");\n\n  // 6️⃣ Decodificar entidades HTML\n  text = text.replace(/&#(\\d+);/g, (_, code) => String.fromCharCode(code));\n  const map = {\n    amp: \"&\", lt: \"<\", gt: \">\", quot: '\"', apos: \"'\", aacute: \"á\",\n    eacute: \"é\", iacute: \"í\", oacute: \"ó\", uacute: \"ú\", ntilde: \"ñ\",\n    Aacute: \"Á\", Eacute: \"É\", Iacute: \"Í\", Oacute: \"Ó\", Uacute: \"Ú\",\n    Ntilde: \"Ñ\"\n  };\n  text = text.replace(/&([a-zA-Z]+);/g, (m, e) => map[e] || m);\n\n  // 7️⃣ Corregir malcodificaciones comunes\n  const fixMap = {\n    \"Ã¡\": \"á\", \"Ã©\": \"é\", \"Ã­\": \"í\", \"Ã³\": \"ó\", \"Ãº\": \"ú\",\n    \"Ã\": \"Á\", \"Ã‰\": \"É\", \"Ã\": \"Í\", \"Ã“\": \"Ó\", \"Ãš\": \"Ú\",\n    \"Ã±\": \"ñ\", \"Ã‘\": \"Ñ\", \"Â\": \"\", \"�\": \"\"\n  };\n  for (const [wrong, right] of Object.entries(fixMap)) {\n    text = text.replace(new RegExp(wrong, \"g\"), right);\n  }\n\n  // 8️⃣ Quitar números y símbolos extraños\n  text = text.replace(/\\d{2,4}\\s*(px|em|%|vh|vw)?/gi, \" \");\n  text = text.replace(/[^\\p{L}\\p{N}\\p{P}\\p{Z}]/gu, \" \");\n\n  // 9️⃣ Compactar espacios y limpiar signos\n  text = text.replace(/\\s+/g, \" \").replace(/\\s*([.,!?;:])\\s*/g, \"$1 \").trim();\n\n  return text;\n}\n\n// Aplicar limpieza a todos los items\nfor (const item of $input.all()) {\n  const contenido = item.json.contenido || \"\";\n  const titulo = item.json.titulo || \"\";\n  item.json.texto_limpio = cleanText(titulo + \". \" + contenido);\n}\n\nreturn $input.all();\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2368,
        400
      ],
      "id": "35dcffe5-d88a-427e-9979-3471bea1bc83",
      "name": "Code in JavaScript7"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 12,
              "triggerAtMinute": 30
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -672,
        -384
      ],
      "id": "650cf0f7-957c-45e4-ae30-e930ac0e7a1f",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "collection": "notice",
        "options": {}
      },
      "type": "n8n-nodes-base.mongoDb",
      "typeVersion": 1.2,
      "position": [
        -432,
        -560
      ],
      "id": "5ffa658d-f470-4cf2-b004-0c0c301b617d",
      "name": "Find documents2",
      "credentials": {
        "mongoDb": {
          "id": "44uvjFS2nQmOBnWb",
          "name": "MongoDB account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        0,
        -384
      ],
      "id": "7ffa574a-bfd3-46be-b8b1-4c462828e024",
      "name": "Merge1"
    },
    {
      "parameters": {
        "jsCode": "// Obtener todos los elementos del nodo anterior\nconst items = $input.all();\n\n// Crear un mapa con la cantidad de veces que aparece cada título\nconst counts = items.reduce((acc, item) => {\n  const title = item.json.title;\n  acc[title] = (acc[title] || 0) + 1;\n  return acc;\n}, {});\n\n// Filtrar solo los items cuyo título aparece exactamente una vez\nreturn items.filter(item => counts[item.json.title] === 1);\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        192,
        -384
      ],
      "id": "30911219-2d6b-4ba7-9a0d-dd7f26bb971d",
      "name": "Code in JavaScript8"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4efbb4d5-5187-428e-991e-eb530897383a",
              "leftValue": "={{ $json.cluster }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gte"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -224,
        -240
      ],
      "id": "faf5591a-2976-42c2-9cc9-ffef732eaef6",
      "name": "If1"
    }
  ],
  "pinData": {},
  "connections": {
    "Find documents": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [],
        [
          {
            "node": "Remove Duplicates",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Find documents1": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "HTML1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request2": {
      "main": [
        [
          {
            "node": "HTML2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request3": {
      "main": [
        [
          {
            "node": "HTML3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request4": {
      "main": [
        [
          {
            "node": "HTML4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request5": {
      "main": [
        [
          {
            "node": "HTML5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request6": {
      "main": [
        [
          {
            "node": "HTML6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request7": {
      "main": [
        [
          {
            "node": "HTML7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTML": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTML1": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTML2": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTML3": {
      "main": [
        [
          {
            "node": "Code in JavaScript3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTML4": {
      "main": [
        [
          {
            "node": "Code in JavaScript4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTML5": {
      "main": [
        [
          {
            "node": "Code in JavaScript5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTML6": {
      "main": [
        [
          {
            "node": "Code in JavaScript6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTML7": {
      "main": [
        [
          {
            "node": "Code in JavaScript7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Edit Fields4": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "Edit Fields5": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 3
          }
        ]
      ]
    },
    "Edit Fields6": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 4
          }
        ]
      ]
    },
    "Edit Fields7": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 5
          }
        ]
      ]
    },
    "Edit Fields8": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 6
          }
        ]
      ]
    },
    "Edit Fields9": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 7
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Insert documents",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Remove Duplicates": {
      "main": [
        [
          {
            "node": "Find documents1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "Edit Fields4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript3": {
      "main": [
        [
          {
            "node": "Edit Fields5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript4": {
      "main": [
        [
          {
            "node": "Edit Fields6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript5": {
      "main": [
        [
          {
            "node": "Edit Fields7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript6": {
      "main": [
        [
          {
            "node": "Edit Fields8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript7": {
      "main": [
        [
          {
            "node": "Edit Fields9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Find documents",
            "type": "main",
            "index": 0
          },
          {
            "node": "Find documents2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Find documents2": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "Code in JavaScript8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript8": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "cc6660f5-a1a3-4653-9c8e-86bbc82e744d",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "dfaa74a960087ae3552b3afefc7f485f943206154cf5ae1a987fac010cf80f86"
  },
  "id": "zrDmW3amwFtjzQEB",
  "tags": []
}